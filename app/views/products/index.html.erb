<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Products</h1>
    <%= link_to 'New Product', new_product_path, class: 'btn btn-outline-primary' %>
  </div>

  <table class="table table-striped">
    <thead class="thead-dark">
      <tr>
        <th>Name</th>
        <th>Discount</th>
        <th>Gas Stations</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @products.each do |product| %>
        <tr>
          <td><%= product.name %></td>
          <td><%= number_to_percentage(Discounts.discount_for(Discounts.key_for(product.discount.to_i)) * 100, precision: 2) %></td>
          <td>
            <% if product.gas_station_products.any? %>
              <ul>
                <% product.gas_station_products.each do |gsp| %>
                  <li>
                    <%= gsp.gas_station.name %> - R$ <%= gsp.price_per_liter %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              No gas stations available
            <% end %>
          <td>
            <%= link_to 'Show', product, class: 'btn btn-info btn-sm' %>
            <%= link_to 'Edit', edit_product_path(product), class: 'btn btn-warning btn-sm' %>
            <%= link_to 'Destroy', product, method: :delete,
                            data: { confirm: 'Are you sure?' },
                            class: 'btn btn-danger btn-sm' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div class="d-flex justify-content-center mt-4">
    <%= paginate @products %>
  </div>
</div>
